<html>
<head>
	<title>Coronavirus (COVID-19) Resource Exhaustion Simulator</title>

	<META name="description" content="A pandemic simulator exemplifying hospital resource exhaustion.">
	<META name="keywords" content="Coronavirus, COVID-19, Face Masks, Regional Resources, CDC Resources, Trackers">
	<META name="copyright" content="(c) 2020 Jason Baker">
	<META name="Author" content="Jason Baker">

	<link rel="stylesheet" href="inc/bootstrap-4.4.1/bootstrap.min.css">
	<link rel="stylesheet" href="inc/bootswatch-flatly/bootstrap.min.css">
	<!-- from: https://github.com/evilstreak/markdown-js" -->
	<script src="inc/markdown-js-0.5.0/markdown.js"></script>
	<!-- <script src="inc/bootstrap-4.4.1/bootstrap.min.js"></script> -->
	<!-- <link rel="stylesheet" href="inc/fontawesome-free-5.12.1/css/all.min.css"> -->
	<style>
		* { font-size:3vmin; }
		@media screen and (min-width: 1000px) {
			* { font-size:18px; }
		}
		.jumbotron { min-height:100%; max-width:1200px; margin-left:auto; margin-right:auto; }
		H5 { font-weight:700; }
		P { margin-left:0.5rem; margin-right:0.5rem; text-align:justify; }
		A { color:#3498DB!important; }
		IMG { max-width:100%; }
		.section { margin-bottom:1rem; border-top:1px solid rgba(0,0,0,0.15); padding-top:1rem; }
	</style>

	<script>		
		var debugMode = false;

		function debug(message, details) {
			if (debugMode) {
				if (details == null) {
					console.log(message);
				} else {
					console.log(message, details);
				}
			}
		}

		//from: https://stackoverflow.com/questions/3885817/how-do-i-check-that-a-number-is-Int-or-integer
		function isInteger(x) { 
			return typeof x === "number" && isFinite(x) && Math.floor(x) === x; 
		}
		//from: https://stackoverflow.com/questions/3885817/how-do-i-check-that-a-number-is-Int-or-integer
		function isInt(x) { 
			return !!(x % 1); 
		}

		/* numberInt = 100, percentInt = 25 (ie 25%), answer = 25 */
		function multiplyAndRound(numberInt, percentInt) {
			if (!isInteger(numberInt)) {
				console.log("multiplyAndRound error, numberInt is not an integer:" + numberInt);
				return null;
			}
			if (!isInteger(percentInt)) {
				console.log("multiplyAndRound error, percentInt is not an integer:" + percentInt);
				return null;
			}
			var result = (numberInt * 1.0) * (percentInt / 100.0);
			result = Math.round(result);
			debug("Result of multiply, numberInt: " + numberInt + ", percentInt: " + percentInt + ", result: " + result);
			return result;
		}

		function incrementDate(date, dayCountInt) {
			var d = new Date(date.getTime());
			d.setDate(d.getDate() + dayCountInt);
			return d;
		}

		/* js class reference: https://www.w3schools.com/js/js_classes.asp */
		class CoronaSimSettings {

			/*
				fields: 

				coronaSimSettings.initialCaseCountOnDayOneInt
				coronaSimSettings.initialDate
				coronaSimSettings.percentNewCasesPerDayInt
				coronaSimSettings.percentCasesResultingInHospitalizationInt
				coronaSimSettings.percentCasesResultingInDeathInt
				coronaSimSettings.percentCasesResultingInSurvivalInt
				coronaSimSettings.numberOfVentilatorsInt
				coronaSimSettings.numberOfHospitalBedsInt
				coronaSimSettings.numberOfDaysHospitalizedInt
			*/

			get initialCaseCountOnDayOneInt() {
				return this._initialCaseCountOnDayOneInt;
			}

			set initialCaseCountOnDayOneInt(x) {
				this._initialCaseCountOnDayOneInt = x;
			}

			get initialDate() {
				return this._initialDate;
			}

			set initialDate(x) {
				this._initialDate = x;
			}

			/* 
				This is the number we use to multiple and determine the new cases per day.

				For example, if this number is 0.10f (10%) and the number of cases on day 1
				is 100 cases, then the new cases on day two would be 100 cases multiplied by 
				this percentage: 100 * 0.10f = 10. 
			*/
			get percentNewCasesPerDayInt() {
				return this._percentageNewCasesPerDayInt;
			}

			set percentNewCasesPerDayInt(x) {
				this._percentageNewCasesPerDayInt = x;
			}

			get percentCasesResultingInHospitalizationInt() {
				return this._percentCasesResultingInHospitalizationInt;
			}

			set percentCasesResultingInHospitalizationInt(x) {
				this._percentCasesResultingInHospitalizationInt = x;
			}

			get percentCasesResultingInDeathInt() {
				return this._percentCasesResultingInDeathInt;
			}

			set percentCasesResultingInDeathInt(x) {
				return this._percentCasesResultingInDeathInt = x;
			}

			get percentCasesResultingInSurvivalInt() {
				return this._percentCasesResultingInSurvivalInt;
			}

			set percentCasesResultingInSurvivalInt(x) {
				this._percentCasesResultingInSurvivalInt = x;
			}

			get numberOfVentilatorsInt() {
				return this._numberOfVentilatorsInt;
			}

			set numberOfVentilatorsInt(x) {
				this._numberOfVentilatorsInt = x;
			}

			get numberOfHospitalBedsInt() {
				return this._numberOfHospitalBedsInt;
			}

			set numberOfHospitalBedsInt(x) {
				this._numberOfHospitalBedsInt = x;
			}			

			get numberOfDaysHospitalizedInt() {
				return this._numberOfDaysHospitalizedInt;
			}

			set numberOfDaysHospitalizedInt(x) {
				this._numberOfDaysHospitalizedInt = x;
			}
		}

		class DayStats {

			/*
				fields: 

				dayStats.dayNumberInt
				dayStats.finalHospitalDayNumberInt
				dayStats.numberOfCasesInt
				dayStats.numberOfCasesInHospitalInt
				dayStats.numberOfCasesResultingInDeathInt
				dayStats.numberOfCasesResultingInSurvivalInt
			*/

			constructor(dayNumberInt, dayBeforeCaseCount, coronaSimSettings) {
				this._dayNumberInt = dayNumberInt;
				this._dayNumberDate = incrementDate(coronaSimSettings.initialDate, dayNumberInt);
				this._finalHospitalDayNumberInt = this._dayNumberInt + coronaSimSettings.numberOfDaysHospitalizedInt;
				this._numberOfCasesInt = dayBeforeCaseCount + multiplyAndRound(dayBeforeCaseCount, coronaSimSettings.percentNewCasesPerDayInt);
				this._numberOfCasesInHospitalInt = multiplyAndRound(this._numberOfCasesInt, coronaSimSettings.percentCasesResultingInHospitalizationInt);
				this._numberOfCasesResultingInDeathInt = multiplyAndRound(this._numberOfCasesInt, coronaSimSettings.percentCasesResultingInDeathInt);
				this._numberOfCasesResultingInSurvivalInt = multiplyAndRound(this._numberOfCasesInt, coronaSimSettings.percentCasesResultingInSurvivalInt);
				debug("DayStats created. dayNumberInt: " + dayNumberInt + ", dayBeforeCaseCount: " 
					+ dayBeforeCaseCount + ", coronaSimSettings: ", this);
			}

			get dayNumberDate() {
				return this._dayNumberDate;
			}

			set dayNumberDate(x) {
				this._dayNumberDate = x;
			}

			get dayNumberInt() {
				return this._dayNumberInt;
			}

			set dayNumberInt(x) {
				this._dayNumberInt = x;
			}

			get finalHospitalDayNumberInt() {
				return this._finalHospitalDayNumberInt;
			}

			set finalHospitalDayNumberInt(x) {
				this._finalHospitalDayNumberInt = x;
			}

			get numberOfCasesInt() {
				return this._numberOfCasesInt;
			}

			set numberOfCasesInt(x) {
				this._numberOfCasesInt = x;
			}

			get numberOfCasesInHospitalInt() {
				return this._numberOfCasesInHospitalInt;			
			}

			set numberOfCasesInHospitalInt(x) {
				this._numberOfCasesInHospitalInt = x;
			}

			get numberOfCasesResultingInDeathInt() {
				return this._numberOfCasesResultingInDeathInt;
			}

			set numberOfCasesResultingInDeathInt(x) {
				this._numberOfCasesResultingInDeathInt = x;
			}

			get numberOfCasesResultingInSurvivalInt() {
				return this._numberOfCasesResultingInSurvivalInt;
			}

			set numberOfCasesResultingInSurvivalInt(x) {
				this._numberOfCasesResultingInSurvivalInt = x;
			}
		}

		class TotalStats {

			/*
				fields: 

				totalStats.totalCasesInt
				totalStats.totalHospitalizationsInt
				totalStats.totalDeathsInt
				totalStats.totalSurvivalsInt
			*/

			constructor() {
				this._totalCasesInt = 0;
				this._totalHospitalizationsInt = 0;
				this._totalDeathsInt = 0;
				this._totalSurvivalsInt = 0;
			}

			addDayStats(dayStats) {
				debug("Total stats adding daystats:", dayStats);
				debug("Total stats state before adding daystats:", this);
				this._totalCasesInt += dayStats.numberOfCasesInt;
				this._totalHospitalizationsInt += dayStats.numberOfCasesInHospitalInt;
				this._totalDeathsInt += dayStats.numberOfCasesResultingInDeathInt;
				this._totalSurvivalsInt += dayStats.numberOfCasesResultingInSurvivalInt;
				debug("Total stats state after adding daystats:", this);
			}

			get totalCasesInt() {
				return this._totalCasesInt;
			}

			get totalHospitalizationsInt() {
				return this._totalHospitalizationsInt;
			}

			get totalDeathsInt() {
				return this._totalDeathsInt;
			}

			get totalSurvivalsInt() {
				return this._totalSurvivalsInt;
			}
		}


		class CoronaSimulator {
			constructor(coronaSimSettings) {
				this._coronaSimSettings = coronaSimSettings;	
				this._currentCaseCountInt = coronaSimSettings.initialCaseCountOnDayOneInt;
				this._currentDayInt = 0;
				this._currentDayStats = null;
				this._dayStatsArray = []; //all day stats so far				
				this._totalStats = new TotalStats();
				debug("CoronaSimulator created:", this);			
			}

			moveForwardOneDay() {
				this._currentDayStats = new DayStats(this._currentDayInt, this._currentCaseCountInt, this._coronaSimSettings);
				this._dayStatsArray.push(this._currentDayStats);
				this._totalStats.addDayStats(this._currentDayStats);
				this._currentCaseCountInt = this._currentDayStats.numberOfCasesInt;
				this._currentDayInt += 1;
				if (debugMode) {
					var message = "Sim moved one day forward. Current day: " + this._currentDayInt + " (" + this.currentDayDate + ")\n";
					var totalStats = this._totalStats;
					message += "\tTotal totalCasesInt: " + totalStats.totalCasesInt.toLocaleString() + "\n";
					message += "\tTotal totalHospitalizationsInt: " + totalStats.totalHospitalizationsInt.toLocaleString() + "\n";
					message += "\tTotal totalDeathsInt: " + totalStats.totalDeathsInt.toLocaleString() + "\n";
					message += "\tTotal totalSurvivalsInt: " + totalStats.totalSurvivalsInt.toLocaleString() + "\n";
					var dayStats = this._currentDayStats;
					message += "\tLatest Day dayNumberInt: " + dayStats.dayNumberInt + "\n";
					message += "\tLatest Day finalHospitalDayNumberInt: " + dayStats.finalHospitalDayNumberInt + "\n";
					message += "\tLatest Day numberOfCasesInt: " + dayStats.numberOfCasesInt.toLocaleString() + "\n";
					message += "\tLatest Day numberOfCasesInHospitalInt: " + dayStats.numberOfCasesInHospitalInt.toLocaleString() + "\n";
					message += "\tLatest Day numberOfCasesResultingInDeathInt: " + dayStats.numberOfCasesResultingInDeathInt.toLocaleString() + "\n";
					message += "\tLatest Day numberOfCasesResultingInSurvivalInt: " + dayStats.numberOfCasesResultingInSurvivalInt.toLocaleString() + "\n";
					message += "\tTotal Number of hospital beds: " + this._coronaSimSettings.numberOfHospitalBedsInt.toLocaleString() + "\n";
					message += "\tCurrent hospital cases: " + this.hospitalizationCountIntForDay(this._currentDayInt).toLocaleString() + "\n";
					message += "\tCurrent beds free: " + this.hospitalBedsAvailableIntForDay(this._currentDayInt).toLocaleString() + "\n";
					debug(message, this);	
				}
			}			

			get currentCaseCountInt() {
				return this._currentCaseCountInt;	
			}

			get currentDayStats() {
				return this._currentDayStats;
			}

			get currentDayInt() {
				return this._currentDayInt;	
			}

			get currentDayDate() {
				return incrementDate(this._coronaSimSettings.initialDate, (this._currentDayInt - 1));
			}

			get coronaSimSettings() {
				return this._coronaSimSettings;	
			}

			get dayStatsArray() {
				return this._dayStatsArray;	
			}

			get currentHospitalizedDayStatsArray() {
				return this._currentHospitalizedDayStatsArray;	
			}

			get totalStats() {
				return this._totalStats;	
			}	

			hospitalizationCountIntForDay(dayNumberInt) {
				var hospitalizationCountInt = 0;
				for (var dayStats of this._dayStatsArray) {
					if (dayStats.dayNumberInt <= dayNumberInt && dayStats.finalHospitalDayNumberInt >= dayNumberInt) {
						hospitalizationCountInt += dayStats.numberOfCasesInHospitalInt;
					}
				}
				return hospitalizationCountInt;
			}

			hospitalBedsAvailableIntForDay(dayNumberInt) {
				return this._coronaSimSettings.numberOfHospitalBedsInt - this.hospitalizationCountIntForDay(dayNumberInt);
			}					
		}

		function runSimulation() {
			debugMode = true;

			var coronaSimSettings = new CoronaSimSettings();
			coronaSimSettings.initialCaseCountOnDayOneInt = 10;
			coronaSimSettings.initialDate = new Date();
			coronaSimSettings.percentNewCasesPerDayInt = 10; // 10%
			coronaSimSettings.percentCasesResultingInHospitalizationInt = 20; // 20%
			coronaSimSettings.percentCasesResultingInDeathInt = 10; // 10%
			coronaSimSettings.percentCasesResultingInSurvivalInt = 90; // 90%
			coronaSimSettings.numberOfVentilatorsInt = 10 * 1000; // 10,000
			coronaSimSettings.numberOfHospitalBedsInt = 1000 * 1000; // 1 million
			coronaSimSettings.numberOfDaysHospitalizedInt = 3;

			var simulator = new CoronaSimulator(coronaSimSettings);

			for (i = 0; i < 100; i++) {
				simulator.moveForwardOneDay();				
			}
		}

		document.addEventListener('DOMContentLoaded', function() {			
			runSimulation();
		}, false);


		/* 
			MVP TODO LIST:
				* Add graph lib
				* Populate graph
				* Show table of data
				* Make sliders
				* Find example starter data, link to sources as much as possible
				* Need to source data: 

			FUTURE FEATURES:
				* allow users to see data for their city, different countries
				* how do numbers change if we can add ventilators every day?
				* how do numbers change if we can add beds every day?
		*/

	</script>
</head>
<body>

<div class="jumbotron">
	<h1>Coronavirus Simulator</h1>

	<div class='section'>
		<h3>What?</h3>

		<p>This is a dynamic simulator built to help citizens understand hospital resource exhaustion.</p>
	</div>

	<!--
	-->

	<div class='section'>
		<h3>Disclaimer</h3>

		<p>Jason is not a trained scientist or doctor. This page is not an authority on <strong>anything</strong>, it's simply a collection of information that Jason hopes you might find useful. Do your own research. Listen to the <a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019">WHO</a>, the <a href="https://www.cdc.gov/coronavirus/2019-nCoV/index.html">CDC</a>, and be safe.</p>
	</div>
	
	<div class='section' id='essentialResources' /></div>	
	<div class='section' id="help"></div>		
	<div class='section' id="regionalResources"></div>
	<div class='section' id="data"></div>
	<div class='section' id='survivalGuide' /></div>
	<div class='section' id='jobs' /></div>	
	<div class='section' id="newsSources"></div>
	<div class='section' id="meta"></div>
</div>


</body>
</html>